var BBoxSelector;BBoxSelector=function(){function t(t,e){null==e&&(e={}),e.input_method||(e.input_method="text"),this.image_frame=t,this.border_width=e.border_width||2,this.selector=$('<div class="bbox_selector"></div>'),this.selector.css({border:this.border_width+"px dotted rgb(127,255,127)",position:"absolute"}),this.image_frame.append(this.selector),this.selector.css({"border-width":this.border_width}),this.selector.hide(),this.create_label_box(e)}return t.prototype.create_label_box=function(t){var e,i,n,o;switch(t.labels||(t.labels=["object"]),this.label_box=$('<div class="label_box"></div>'),this.label_box.css({position:"absolute"}),this.image_frame.append(this.label_box),t.input_method){case"select":for("string"==typeof t.labels&&(t.labels=[t.labels]),this.label_input=$('<select class="label_input" name="label"></select>'),this.label_box.append(this.label_input),this.label_input.append($("<option value>choose an item</option>")),o=t.labels,e=0,n=o.length;e<n;e++)i=o[e],this.label_input.append('<option value="'+i+'">'+i+"</option>");this.label_input.change(function(t){return this.blur()});break;case"text":"string"==typeof t.labels&&(t.labels=[t.labels]),this.label_input=$('<input class="label_input" name="label" type="text" value>'),this.label_box.append(this.label_input),this.label_input.autocomplete({source:t.labels||[""],autoFocus:!0});break;case"fixed":$.isArray(t.labels)&&(t.labels=t.labels[0]),this.label_input=$('<input class="label_input" name="label" type="text">'),this.label_box.append(this.label_input),this.label_input.val(t.labels);break;default:throw"Invalid label_input parameter: "+t.input_method}return this.label_box.hide()},t.prototype.crop=function(t,e){var i;return i={x:Math.min(Math.max(Math.round(t-this.image_frame.offset().left),0),Math.round(this.image_frame.width()-1)),y:Math.min(Math.max(Math.round(e-this.image_frame.offset().top),0),Math.round(this.image_frame.height()-1))}},t.prototype.start=function(t,e){return this.pointer=this.crop(t,e),this.offset=this.pointer,this.refresh(),this.selector.show(),$("body").css("cursor","crosshair"),document.onselectstart=function(){return!1}},t.prototype.update_rectangle=function(t,e){return this.pointer=this.crop(t,e),this.refresh()},t.prototype.input_label=function(t){return $("body").css("cursor","default"),document.onselectstart=function(){return!0},this.label_box.show(),this.label_input.focus()},t.prototype.finish=function(t){var e;return this.label_box.hide(),this.selector.hide(),e=this.rectangle(),e.label=$.trim(this.label_input.val().toLowerCase()),"fixed"!==t.input_method&&this.label_input.val(""),e},t.prototype.rectangle=function(){var t,e,i,n,o;return e=Math.min(this.offset.x,this.pointer.x),n=Math.min(this.offset.y,this.pointer.y),i=Math.max(this.offset.x,this.pointer.x),o=Math.max(this.offset.y,this.pointer.y),t={left:e,top:n,width:i-e+1,height:o-n+1}},t.prototype.refresh=function(){var t;return t=this.rectangle(),this.selector.css({left:t.left-this.border_width+"px",top:t.top-this.border_width+"px",width:t.width+"px",height:t.height+"px"}),this.label_box.css({left:t.left-this.border_width+"px",top:t.top+t.height+this.border_width+"px"})},t.prototype.get_input_element=function(){return this.label_input},t}(),this.BBoxAnnotator=function(){function t(t){var e,i;e=this,this.annotator_element=$(t.id||"#bbox_annotator"),this.border_width=t.border_width||2,this.show_label=t.show_label||"fixed"!==t.input_method,this.image_frame=$('<div class="image_frame"></div>'),this.annotator_element.append(this.image_frame),i=new Image,i.src=t.url,i.onload=function(){return t.width||(t.width=i.width),t.height||(t.height=i.height),e.annotator_element.css({width:t.width+2*e.border_width+"px",height:t.height+2*e.border_width+"px",cursor:"crosshair"}),e.image_frame.css({"background-image":"url('"+i.src+"')",width:t.width+"px",height:t.height+"px",position:"relative"}),e.selector=new BBoxSelector(e.image_frame,t),e.initialize_events(e.selector,t)},i.onerror=function(){return e.annotator_element.text("Invalid image URL: "+t.url)},this.entries=[],this.onchange=t.onchange}return t.prototype.initialize_events=function(t,e){var i,n;return n="free",this.hit_menuitem=!1,i=this,this.annotator_element.mousedown(function(e){if(!i.hit_menuitem)switch(n){case"free":case"input":"input"===n&&t.get_input_element().blur(),1===e.which&&(t.start(e.pageX,e.pageY),n="hold")}return i.hit_menuitem=!1,!0}),$(window).mousemove(function(e){switch(n){case"hold":t.update_rectangle(e.pageX,e.pageY)}return!0}),$(window).mouseup(function(i){switch(n){case"hold":t.update_rectangle(i.pageX,i.pageY),t.input_label(e),n="input","fixed"===e.input_method&&t.get_input_element().blur()}return!0}),t.get_input_element().blur(function(o){var r;switch(n){case"input":r=t.finish(e),r.label&&(i.add_entry(r),i.onchange&&i.onchange(i.entries)),n="free"}return!0}),t.get_input_element().keypress(function(e){switch(n){case"input":13===e.which&&t.get_input_element().blur()}return 13!==e.which}),t.get_input_element().mousedown(function(t){return i.hit_menuitem=!0}),t.get_input_element().mousemove(function(t){return i.hit_menuitem=!0}),t.get_input_element().mouseup(function(t){return i.hit_menuitem=!0}),t.get_input_element().parent().mousedown(function(t){return i.hit_menuitem=!0})},t.prototype.add_entry=function(t){var e,i,n,o;return this.entries.push(t),i=$('<div class="annotated_bounding_box"></div>'),i.appendTo(this.image_frame).css({border:this.border_width+"px solid rgb(127,255,127)",position:"absolute",top:t.top-this.border_width+"px",left:t.left-this.border_width+"px",width:t.width+"px",height:t.height+"px",color:"rgb(127,255,127)","font-family":"monospace","font-size":"small"}),n=$("<div></div>").appendTo(i).css({position:"absolute",top:"-8px",right:"-8px",width:"16px",height:"0",padding:"16px 0 0 0",overflow:"hidden",color:"#fff","background-color":"#030",border:"2px solid #fff","-moz-border-radius":"18px","-webkit-border-radius":"18px","border-radius":"18px",cursor:"pointer","-moz-user-select":"none","-webkit-user-select":"none","user-select":"none","text-align":"center"}),$("<div></div>").appendTo(n).html("&#215;").css({display:"block","text-align":"center",width:"16px",position:"absolute",top:"-2px",left:"0","font-size":"16px","line-height":"16px","font-family":'"Helvetica Neue", Consolas, Verdana, Tahoma, Calibri, Helvetica, Menlo, "Droid Sans", sans-serif'}),o=$("<div></div>").appendTo(i).css({overflow:"hidden"}),this.show_label&&o.text(t.label),e=this,i.hover(function(t){return n.show()},function(t){return n.hide()}),n.mousedown(function(t){return e.hit_menuitem=!0}),n.click(function(t){var i,o;return i=n.parent(".annotated_bounding_box"),o=i.prevAll(".annotated_bounding_box").length,i.detach(),e.entries.splice(o,1),e.onchange(e.entries)}),n.hide()},t.prototype.clear_all=function(t){return this.annotator_element.find(".annotated_bounding_box").detach(),this.entries.splice(0),this.onchange(this.entries)},t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJib3hfYW5ub3RhdG9yLmpzIl0sIm5hbWVzIjpbIkJCb3hTZWxlY3RvciIsImltYWdlX2ZyYW1lIiwib3B0aW9ucyIsImlucHV0X21ldGhvZCIsInRoaXMiLCJib3JkZXJfd2lkdGgiLCJzZWxlY3RvciIsIiQiLCJjc3MiLCJib3JkZXIiLCJwb3NpdGlvbiIsImFwcGVuZCIsImJvcmRlci13aWR0aCIsImhpZGUiLCJjcmVhdGVfbGFiZWxfYm94IiwicHJvdG90eXBlIiwiaSIsImxhYmVsIiwibGVuIiwicmVmIiwibGFiZWxzIiwibGFiZWxfYm94IiwibGFiZWxfaW5wdXQiLCJsZW5ndGgiLCJjaGFuZ2UiLCJlIiwiYmx1ciIsImF1dG9jb21wbGV0ZSIsInNvdXJjZSIsImF1dG9Gb2N1cyIsImlzQXJyYXkiLCJ2YWwiLCJjcm9wIiwicGFnZVgiLCJwYWdlWSIsInBvaW50IiwieCIsIk1hdGgiLCJtaW4iLCJtYXgiLCJyb3VuZCIsIm9mZnNldCIsImxlZnQiLCJ3aWR0aCIsInkiLCJ0b3AiLCJoZWlnaHQiLCJzdGFydCIsInBvaW50ZXIiLCJyZWZyZXNoIiwic2hvdyIsImRvY3VtZW50Iiwib25zZWxlY3RzdGFydCIsInVwZGF0ZV9yZWN0YW5nbGUiLCJpbnB1dF9sYWJlbCIsImZvY3VzIiwiZmluaXNoIiwiZGF0YSIsInJlY3RhbmdsZSIsInRyaW0iLCJ0b0xvd2VyQ2FzZSIsInJlY3QiLCJ4MSIsIngyIiwieTEiLCJ5MiIsImdldF9pbnB1dF9lbGVtZW50IiwiQkJveEFubm90YXRvciIsImFubm90YXRvciIsImltYWdlX2VsZW1lbnQiLCJhbm5vdGF0b3JfZWxlbWVudCIsImlkIiwic2hvd19sYWJlbCIsIkltYWdlIiwic3JjIiwidXJsIiwib25sb2FkIiwiY3Vyc29yIiwiYmFja2dyb3VuZC1pbWFnZSIsImluaXRpYWxpemVfZXZlbnRzIiwib25lcnJvciIsInRleHQiLCJlbnRyaWVzIiwib25jaGFuZ2UiLCJzdGF0dXMiLCJoaXRfbWVudWl0ZW0iLCJtb3VzZWRvd24iLCJ3aGljaCIsIndpbmRvdyIsIm1vdXNlbW92ZSIsIm1vdXNldXAiLCJhZGRfZW50cnkiLCJrZXlwcmVzcyIsInBhcmVudCIsImVudHJ5IiwiYm94X2VsZW1lbnQiLCJjbG9zZV9idXR0b24iLCJ0ZXh0X2JveCIsInB1c2giLCJhcHBlbmRUbyIsImNvbG9yIiwiZm9udC1mYW1pbHkiLCJmb250LXNpemUiLCJyaWdodCIsInBhZGRpbmciLCJvdmVyZmxvdyIsImJhY2tncm91bmQtY29sb3IiLCItbW96LWJvcmRlci1yYWRpdXMiLCItd2Via2l0LWJvcmRlci1yYWRpdXMiLCJib3JkZXItcmFkaXVzIiwiLW1vei11c2VyLXNlbGVjdCIsIi13ZWJraXQtdXNlci1zZWxlY3QiLCJ1c2VyLXNlbGVjdCIsInRleHQtYWxpZ24iLCJodG1sIiwiZGlzcGxheSIsImxpbmUtaGVpZ2h0IiwiaG92ZXIiLCJjbGljayIsImNsaWNrZWRfYm94IiwiaW5kZXgiLCJwcmV2QWxsIiwiZGV0YWNoIiwic3BsaWNlIiwiY2xlYXJfYWxsIiwiZmluZCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBSUEsYUFFSkEsY0FBZSxXQUNiLFFBQVNBLEdBQWFDLEVBQWFDLEdBQ2xCLE1BQVhBLElBQ0ZBLE1BRUZBLEVBQVFDLGVBQWlCRCxFQUFRQyxhQUFlLFFBQ2hEQyxLQUFLSCxZQUFjQSxFQUNuQkcsS0FBS0MsYUFBZUgsRUFBUUcsY0FBZ0IsRUFDNUNELEtBQUtFLFNBQVdDLEVBQUUscUNBQ2xCSCxLQUFLRSxTQUFTRSxLQUNaQyxPQUFVTCxLQUFLQyxhQUFlLDZCQUM5QkssU0FBWSxhQUVkTixLQUFLSCxZQUFZVSxPQUFPUCxLQUFLRSxVQUM3QkYsS0FBS0UsU0FBU0UsS0FDWkksZUFBZ0JSLEtBQUtDLGVBRXZCRCxLQUFLRSxTQUFTTyxPQUNkVCxLQUFLVSxpQkFBaUJaLEdBbUl4QixNQWhJQUYsR0FBYWUsVUFBVUQsaUJBQW1CLFNBQVNaLEdBQ2pELEdBQUljLEdBQUdDLEVBQU9DLEVBQUtDLENBT25CLFFBTkFqQixF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SCxLQUFRLElBQ1I0RCxZQUFhLE9BQ2JjLGNBQWUsT0FDZmYsY0FBZSxxR0FFakJKLEVBQVcxRixFQUFFLGVBQWU0RixTQUFTSixHQUFhdkYsS0FDaERpRyxTQUFZLFdBRVZyRyxLQUFLb0UsWUFDUHlCLEVBQVNoQixLQUFLYSxFQUFNN0UsT0FFdEJtRCxFQUFZaEUsS0FDWjJGLEVBQVlzQixNQUFNLFNBQVU1RixHQUMxQixNQUFPdUUsR0FBYTlDLFFBQ2xCLFNBQVV6QixHQUNaLE1BQU91RSxHQUFhbkYsU0FFdEJtRixFQUFhVixVQUFVLFNBQVM3RCxHQUM5QixNQUFPMkMsR0FBVWlCLGNBQWUsSUFFbENXLEVBQWFzQixNQUFNLFNBQVM3RixHQUMxQixHQUFJOEYsR0FBYUMsQ0FLakIsT0FKQUQsR0FBY3ZCLEVBQWFILE9BQU8sMkJBQ2xDMkIsRUFBUUQsRUFBWUUsUUFBUSwyQkFBMkJsRyxPQUN2RGdHLEVBQVlHLFNBQ1p0RCxFQUFVYyxRQUFReUMsT0FBT0gsRUFBTyxHQUN6QnBELEVBQVVlLFNBQVNmLEVBQVVjLFdBRS9CYyxFQUFhbkYsUUFHdEJzRCxFQUFjcEQsVUFBVTZHLFVBQVksU0FBU25HLEdBRzNDLE1BRkFyQixNQUFLa0Usa0JBQWtCdUQsS0FBSywyQkFBMkJILFNBQ3ZEdEgsS0FBSzhFLFFBQVF5QyxPQUFPLEdBQ2J2SCxLQUFLK0UsU0FBUy9FLEtBQUs4RSxVQUdyQmYiLCJmaWxlIjoiYmJveF9hbm5vdGF0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgQkJveFNlbGVjdG9yO1xuXG5CQm94U2VsZWN0b3IgPSAoZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIEJCb3hTZWxlY3RvcihpbWFnZV9mcmFtZSwgb3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zID09IG51bGwpIHtcbiAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICB9XG4gICAgb3B0aW9ucy5pbnB1dF9tZXRob2QgfHwgKG9wdGlvbnMuaW5wdXRfbWV0aG9kID0gXCJ0ZXh0XCIpO1xuICAgIHRoaXMuaW1hZ2VfZnJhbWUgPSBpbWFnZV9mcmFtZTtcbiAgICB0aGlzLmJvcmRlcl93aWR0aCA9IG9wdGlvbnMuYm9yZGVyX3dpZHRoIHx8IDI7XG4gICAgdGhpcy5zZWxlY3RvciA9ICQoJzxkaXYgY2xhc3M9XCJiYm94X3NlbGVjdG9yXCI+PC9kaXY+Jyk7XG4gICAgdGhpcy5zZWxlY3Rvci5jc3Moe1xuICAgICAgXCJib3JkZXJcIjogdGhpcy5ib3JkZXJfd2lkdGggKyBcInB4IGRvdHRlZCByZ2IoMTI3LDI1NSwxMjcpXCIsXG4gICAgICBcInBvc2l0aW9uXCI6IFwiYWJzb2x1dGVcIlxuICAgIH0pO1xuICAgIHRoaXMuaW1hZ2VfZnJhbWUuYXBwZW5kKHRoaXMuc2VsZWN0b3IpO1xuICAgIHRoaXMuc2VsZWN0b3IuY3NzKHtcbiAgICAgIFwiYm9yZGVyLXdpZHRoXCI6IHRoaXMuYm9yZGVyX3dpZHRoXG4gICAgfSk7XG4gICAgdGhpcy5zZWxlY3Rvci5oaWRlKCk7XG4gICAgdGhpcy5jcmVhdGVfbGFiZWxfYm94KG9wdGlvbnMpO1xuICB9XG5cbiAgQkJveFNlbGVjdG9yLnByb3RvdHlwZS5jcmVhdGVfbGFiZWxfYm94ID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHZhciBpLCBsYWJlbCwgbGVuLCByZWY7XG4gICAgb3B0aW9ucy5sYWJlbHMgfHwgKG9wdGlvbnMubGFiZWxzID0gW1wib2JqZWN0XCJdKTtcbiAgICB0aGlzLmxhYmVsX2JveCA9ICQoJzxkaXYgY2xhc3M9XCJsYWJlbF9ib3hcIj48L2Rpdj4nKTtcbiAgICB0aGlzLmxhYmVsX2JveC5jc3Moe1xuICAgICAgXCJwb3NpdGlvblwiOiBcImFic29sdXRlXCJcbiAgICB9KTtcbiAgICB0aGlzLmltYWdlX2ZyYW1lLmFwcGVuZCh0aGlzLmxhYmVsX2JveCk7XG4gICAgc3dpdGNoIChvcHRpb25zLmlucHV0X21ldGhvZCkge1xuICAgICAgY2FzZSAnc2VsZWN0JzpcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmxhYmVscyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIG9wdGlvbnMubGFiZWxzID0gW29wdGlvbnMubGFiZWxzXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhYmVsX2lucHV0ID0gJCgnPHNlbGVjdCBjbGFzcz1cImxhYmVsX2lucHV0XCIgbmFtZT1cImxhYmVsXCI+PC9zZWxlY3Q+Jyk7XG4gICAgICAgIHRoaXMubGFiZWxfYm94LmFwcGVuZCh0aGlzLmxhYmVsX2lucHV0KTtcbiAgICAgICAgdGhpcy5sYWJlbF9pbnB1dC5hcHBlbmQoJCgnPG9wdGlvbiB2YWx1ZT5jaG9vc2UgYW4gaXRlbTwvb3B0aW9uPicpKTtcbiAgICAgICAgcmVmID0gb3B0aW9ucy5sYWJlbHM7XG4gICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHJlZi5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGxhYmVsID0gcmVmW2ldO1xuICAgICAgICAgIHRoaXMubGFiZWxfaW5wdXQuYXBwZW5kKCc8b3B0aW9uIHZhbHVlPVwiJyArIGxhYmVsICsgJ1wiPicgKyBsYWJlbCArICc8L29wdGlvbj4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhYmVsX2lucHV0LmNoYW5nZShmdW5jdGlvbihlKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuYmx1cigpO1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmxhYmVscyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIG9wdGlvbnMubGFiZWxzID0gW29wdGlvbnMubGFiZWxzXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhYmVsX2lucHV0ID0gJCgnPGlucHV0IGNsYXNzPVwibGFiZWxfaW5wdXRcIiBuYW1lPVwibGFiZWxcIiAnICsgJ3R5cGU9XCJ0ZXh0XCIgdmFsdWU+Jyk7XG4gICAgICAgIHRoaXMubGFiZWxfYm94LmFwcGVuZCh0aGlzLmxhYmVsX2lucHV0KTtcbiAgICAgICAgdGhpcy5sYWJlbF9pbnB1dC5hdXRvY29tcGxldGUoe1xuICAgICAgICAgIHNvdXJjZTogb3B0aW9ucy5sYWJlbHMgfHwgWycnXSxcbiAgICAgICAgICBhdXRvRm9jdXM6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZml4ZWQnOlxuICAgICAgICBpZiAoJC5pc0FycmF5KG9wdGlvbnMubGFiZWxzKSkge1xuICAgICAgICAgIG9wdGlvbnMubGFiZWxzID0gb3B0aW9ucy5sYWJlbHNbMF07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYWJlbF9pbnB1dCA9ICQoJzxpbnB1dCBjbGFzcz1cImxhYmVsX2lucHV0XCIgbmFtZT1cImxhYmVsXCIgdHlwZT1cInRleHRcIj4nKTtcbiAgICAgICAgdGhpcy5sYWJlbF9ib3guYXBwZW5kKHRoaXMubGFiZWxfaW5wdXQpO1xuICAgICAgICB0aGlzLmxhYmVsX2lucHV0LnZhbChvcHRpb25zLmxhYmVscyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgJ0ludmFsaWQgbGFiZWxfaW5wdXQgcGFyYW1ldGVyOiAnICsgb3B0aW9ucy5pbnB1dF9tZXRob2Q7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmxhYmVsX2JveC5oaWRlKCk7XG4gIH07XG5cbiAgQkJveFNlbGVjdG9yLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24ocGFnZVgsIHBhZ2VZKSB7XG4gICAgdmFyIHBvaW50O1xuICAgIHJldHVybiBwb2ludCA9IHtcbiAgICAgIHg6IE1hdGgubWluKE1hdGgubWF4KE1hdGgucm91bmQocGFnZVggLSB0aGlzLmltYWdlX2ZyYW1lLm9mZnNldCgpLmxlZnQpLCAwKSwgTWF0aC5yb3VuZCh0aGlzLmltYWdlX2ZyYW1lLndpZHRoKCkgLSAxKSksXG4gICAgICB5OiBNYXRoLm1pbihNYXRoLm1heChNYXRoLnJvdW5kKHBhZ2VZIC0gdGhpcy5pbWFnZV9mcmFtZS5vZmZzZXQoKS50b3ApLCAwKSwgTWF0aC5yb3VuZCh0aGlzLmltYWdlX2ZyYW1lLmhlaWdodCgpIC0gMSkpXG4gICAgfTtcbiAgfTtcblxuICBCQm94U2VsZWN0b3IucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24ocGFnZVgsIHBhZ2VZKSB7XG4gICAgdGhpcy5wb2ludGVyID0gdGhpcy5jcm9wKHBhZ2VYLCBwYWdlWSk7XG4gICAgdGhpcy5vZmZzZXQgPSB0aGlzLnBvaW50ZXI7XG4gICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgdGhpcy5zZWxlY3Rvci5zaG93KCk7XG4gICAgJCgnYm9keScpLmNzcygnY3Vyc29yJywgJ2Nyb3NzaGFpcicpO1xuICAgIHJldHVybiBkb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgfTtcblxuICBCQm94U2VsZWN0b3IucHJvdG90eXBlLnVwZGF0ZV9yZWN0YW5nbGUgPSBmdW5jdGlvbihwYWdlWCwgcGFnZVkpIHtcbiAgICB0aGlzLnBvaW50ZXIgPSB0aGlzLmNyb3AocGFnZVgsIHBhZ2VZKTtcbiAgICByZXR1cm4gdGhpcy5yZWZyZXNoKCk7XG4gIH07XG5cbiAgQkJveFNlbGVjdG9yLnByb3RvdHlwZS5pbnB1dF9sYWJlbCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAkKCdib2R5JykuY3NzKCdjdXJzb3InLCAnZGVmYXVsdCcpO1xuICAgIGRvY3VtZW50Lm9uc2VsZWN0c3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgdGhpcy5sYWJlbF9ib3guc2hvdygpO1xuICAgIHJldHVybiB0aGlzLmxhYmVsX2lucHV0LmZvY3VzKCk7XG4gIH07XG5cbiAgQkJveFNlbGVjdG9yLnByb3RvdHlwZS5maW5pc2ggPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdmFyIGRhdGE7XG4gICAgdGhpcy5sYWJlbF9ib3guaGlkZSgpO1xuICAgIHRoaXMuc2VsZWN0b3IuaGlkZSgpO1xuICAgIGRhdGEgPSB0aGlzLnJlY3RhbmdsZSgpO1xuICAgIGRhdGEubGFiZWwgPSAkLnRyaW0odGhpcy5sYWJlbF9pbnB1dC52YWwoKS50b0xvd2VyQ2FzZSgpKTtcbiAgICBpZiAob3B0aW9ucy5pbnB1dF9tZXRob2QgIT09ICdmaXhlZCcpIHtcbiAgICAgIHRoaXMubGFiZWxfaW5wdXQudmFsKCcnKTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgQkJveFNlbGVjdG9yLnByb3RvdHlwZS5yZWN0YW5nbGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcmVjdCwgeDEsIHgyLCB5MSwgeTI7XG4gICAgeDEgPSBNYXRoLm1pbih0aGlzLm9mZnNldC54LCB0aGlzLnBvaW50ZXIueCk7XG4gICAgeTEgPSBNYXRoLm1pbih0aGlzLm9mZnNldC55LCB0aGlzLnBvaW50ZXIueSk7XG4gICAgeDIgPSBNYXRoLm1heCh0aGlzLm9mZnNldC54LCB0aGlzLnBvaW50ZXIueCk7XG4gICAgeTIgPSBNYXRoLm1heCh0aGlzLm9mZnNldC55LCB0aGlzLnBvaW50ZXIueSk7XG4gICAgcmV0dXJuIHJlY3QgPSB7XG4gICAgICBsZWZ0OiB4MSxcbiAgICAgIHRvcDogeTEsXG4gICAgICB3aWR0aDogeDIgLSB4MSArIDEsXG4gICAgICBoZWlnaHQ6IHkyIC0geTEgKyAxXG4gICAgfTtcbiAgfTtcblxuICBCQm94U2VsZWN0b3IucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcmVjdDtcbiAgICByZWN0ID0gdGhpcy5yZWN0YW5nbGUoKTtcbiAgICB0aGlzLnNlbGVjdG9yLmNzcyh7XG4gICAgICBsZWZ0OiAocmVjdC5sZWZ0IC0gdGhpcy5ib3JkZXJfd2lkdGgpICsgJ3B4JyxcbiAgICAgIHRvcDogKHJlY3QudG9wIC0gdGhpcy5ib3JkZXJfd2lkdGgpICsgJ3B4JyxcbiAgICAgIHdpZHRoOiByZWN0LndpZHRoICsgJ3B4JyxcbiAgICAgIGhlaWdodDogcmVjdC5oZWlnaHQgKyAncHgnXG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMubGFiZWxfYm94LmNzcyh7XG4gICAgICBsZWZ0OiAocmVjdC5sZWZ0IC0gdGhpcy5ib3JkZXJfd2lkdGgpICsgJ3B4JyxcbiAgICAgIHRvcDogKHJlY3QudG9wICsgcmVjdC5oZWlnaHQgKyB0aGlzLmJvcmRlcl93aWR0aCkgKyAncHgnXG4gICAgfSk7XG4gIH07XG5cbiAgQkJveFNlbGVjdG9yLnByb3RvdHlwZS5nZXRfaW5wdXRfZWxlbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmxhYmVsX2lucHV0O1xuICB9O1xuXG4gIHJldHVybiBCQm94U2VsZWN0b3I7XG5cbn0pKCk7XG5cbnRoaXMuQkJveEFubm90YXRvciA9IChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gQkJveEFubm90YXRvcihvcHRpb25zKSB7XG4gICAgdmFyIGFubm90YXRvciwgaW1hZ2VfZWxlbWVudDtcbiAgICBhbm5vdGF0b3IgPSB0aGlzO1xuICAgIHRoaXMuYW5ub3RhdG9yX2VsZW1lbnQgPSAkKG9wdGlvbnMuaWQgfHwgXCIjYmJveF9hbm5vdGF0b3JcIik7XG4gICAgdGhpcy5ib3JkZXJfd2lkdGggPSBvcHRpb25zLmJvcmRlcl93aWR0aCB8fCAyO1xuICAgIHRoaXMuc2hvd19sYWJlbCA9IG9wdGlvbnMuc2hvd19sYWJlbCB8fCAob3B0aW9ucy5pbnB1dF9tZXRob2QgIT09IFwiZml4ZWRcIik7XG4gICAgdGhpcy5pbWFnZV9mcmFtZSA9ICQoJzxkaXYgY2xhc3M9XCJpbWFnZV9mcmFtZVwiPjwvZGl2PicpO1xuICAgIHRoaXMuYW5ub3RhdG9yX2VsZW1lbnQuYXBwZW5kKHRoaXMuaW1hZ2VfZnJhbWUpO1xuICAgIGltYWdlX2VsZW1lbnQgPSBuZXcgSW1hZ2UoKTtcbiAgICBpbWFnZV9lbGVtZW50LnNyYyA9IG9wdGlvbnMudXJsO1xuICAgIGltYWdlX2VsZW1lbnQub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICBvcHRpb25zLndpZHRoIHx8IChvcHRpb25zLndpZHRoID0gaW1hZ2VfZWxlbWVudC53aWR0aCk7XG4gICAgICBvcHRpb25zLmhlaWdodCB8fCAob3B0aW9ucy5oZWlnaHQgPSBpbWFnZV9lbGVtZW50LmhlaWdodCk7XG4gICAgICBhbm5vdGF0b3IuYW5ub3RhdG9yX2VsZW1lbnQuY3NzKHtcbiAgICAgICAgXCJ3aWR0aFwiOiAob3B0aW9ucy53aWR0aCArIGFubm90YXRvci5ib3JkZXJfd2lkdGggKiAyKSArICdweCcsXG4gICAgICAgIFwiaGVpZ2h0XCI6IChvcHRpb25zLmhlaWdodCArIGFubm90YXRvci5ib3JkZXJfd2lkdGggKiAyKSArICdweCcsXG4gICAgICAgIFwiY3Vyc29yXCI6IFwiY3Jvc3NoYWlyXCJcbiAgICAgIH0pO1xuICAgICAgYW5ub3RhdG9yLmltYWdlX2ZyYW1lLmNzcyh7XG4gICAgICAgIFwiYmFja2dyb3VuZC1pbWFnZVwiOiBcInVybCgnXCIgKyBpbWFnZV9lbGVtZW50LnNyYyArIFwiJylcIixcbiAgICAgICAgXCJ3aWR0aFwiOiBvcHRpb25zLndpZHRoICsgXCJweFwiLFxuICAgICAgICBcImhlaWdodFwiOiBvcHRpb25zLmhlaWdodCArIFwicHhcIixcbiAgICAgICAgXCJwb3NpdGlvblwiOiBcInJlbGF0aXZlXCJcbiAgICAgIH0pO1xuICAgICAgYW5ub3RhdG9yLnNlbGVjdG9yID0gbmV3IEJCb3hTZWxlY3Rvcihhbm5vdGF0b3IuaW1hZ2VfZnJhbWUsIG9wdGlvbnMpO1xuICAgICAgcmV0dXJuIGFubm90YXRvci5pbml0aWFsaXplX2V2ZW50cyhhbm5vdGF0b3Iuc2VsZWN0b3IsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgaW1hZ2VfZWxlbWVudC5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYW5ub3RhdG9yLmFubm90YXRvcl9lbGVtZW50LnRleHQoXCJJbnZhbGlkIGltYWdlIFVSTDogXCIgKyBvcHRpb25zLnVybCk7XG4gICAgfTtcbiAgICB0aGlzLmVudHJpZXMgPSBbXTtcbiAgICB0aGlzLm9uY2hhbmdlID0gb3B0aW9ucy5vbmNoYW5nZTtcbiAgfVxuXG4gIEJCb3hBbm5vdGF0b3IucHJvdG90eXBlLmluaXRpYWxpemVfZXZlbnRzID0gZnVuY3Rpb24oc2VsZWN0b3IsIG9wdGlvbnMpIHtcbiAgICB2YXIgYW5ub3RhdG9yLCBzdGF0dXM7XG4gICAgc3RhdHVzID0gJ2ZyZWUnO1xuICAgIHRoaXMuaGl0X21lbnVpdGVtID0gZmFsc2U7XG4gICAgYW5ub3RhdG9yID0gdGhpcztcbiAgICB0aGlzLmFubm90YXRvcl9lbGVtZW50Lm1vdXNlZG93bihmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoIWFubm90YXRvci5oaXRfbWVudWl0ZW0pIHtcbiAgICAgICAgc3dpdGNoIChzdGF0dXMpIHtcbiAgICAgICAgICBjYXNlICdmcmVlJzpcbiAgICAgICAgICBjYXNlICdpbnB1dCc6XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnaW5wdXQnKSB7XG4gICAgICAgICAgICAgIHNlbGVjdG9yLmdldF9pbnB1dF9lbGVtZW50KCkuYmx1cigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGUud2hpY2ggPT09IDEpIHtcbiAgICAgICAgICAgICAgc2VsZWN0b3Iuc3RhcnQoZS5wYWdlWCwgZS5wYWdlWSk7XG4gICAgICAgICAgICAgIHN0YXR1cyA9ICdob2xkJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYW5ub3RhdG9yLmhpdF9tZW51aXRlbSA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gICAgJCh3aW5kb3cpLm1vdXNlbW92ZShmdW5jdGlvbihlKSB7XG4gICAgICBzd2l0Y2ggKHN0YXR1cykge1xuICAgICAgICBjYXNlICdob2xkJzpcbiAgICAgICAgICBzZWxlY3Rvci51cGRhdGVfcmVjdGFuZ2xlKGUucGFnZVgsIGUucGFnZVkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gICAgJCh3aW5kb3cpLm1vdXNldXAoZnVuY3Rpb24oZSkge1xuICAgICAgc3dpdGNoIChzdGF0dXMpIHtcbiAgICAgICAgY2FzZSAnaG9sZCc6XG4gICAgICAgICAgc2VsZWN0b3IudXBkYXRlX3JlY3RhbmdsZShlLnBhZ2VYLCBlLnBhZ2VZKTtcbiAgICAgICAgICBzZWxlY3Rvci5pbnB1dF9sYWJlbChvcHRpb25zKTtcbiAgICAgICAgICBzdGF0dXMgPSAnaW5wdXQnO1xuICAgICAgICAgIGlmIChvcHRpb25zLmlucHV0X21ldGhvZCA9PT0gJ2ZpeGVkJykge1xuICAgICAgICAgICAgc2VsZWN0b3IuZ2V0X2lucHV0X2VsZW1lbnQoKS5ibHVyKCk7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gICAgc2VsZWN0b3IuZ2V0X2lucHV0X2VsZW1lbnQoKS5ibHVyKGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciBkYXRhO1xuICAgICAgc3dpdGNoIChzdGF0dXMpIHtcbiAgICAgICAgY2FzZSAnaW5wdXQnOlxuICAgICAgICAgIGRhdGEgPSBzZWxlY3Rvci5maW5pc2gob3B0aW9ucyk7XG4gICAgICAgICAgaWYgKGRhdGEubGFiZWwpIHtcbiAgICAgICAgICAgIGFubm90YXRvci5hZGRfZW50cnkoZGF0YSk7XG4gICAgICAgICAgICBpZiAoYW5ub3RhdG9yLm9uY2hhbmdlKSB7XG4gICAgICAgICAgICAgIGFubm90YXRvci5vbmNoYW5nZShhbm5vdGF0b3IuZW50cmllcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHN0YXR1cyA9ICdmcmVlJztcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuICAgIHNlbGVjdG9yLmdldF9pbnB1dF9lbGVtZW50KCkua2V5cHJlc3MoZnVuY3Rpb24oZSkge1xuICAgICAgc3dpdGNoIChzdGF0dXMpIHtcbiAgICAgICAgY2FzZSAnaW5wdXQnOlxuICAgICAgICAgIGlmIChlLndoaWNoID09PSAxMykge1xuICAgICAgICAgICAgc2VsZWN0b3IuZ2V0X2lucHV0X2VsZW1lbnQoKS5ibHVyKCk7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGUud2hpY2ggIT09IDEzO1xuICAgIH0pO1xuICAgIHNlbGVjdG9yLmdldF9pbnB1dF9lbGVtZW50KCkubW91c2Vkb3duKGZ1bmN0aW9uKGUpIHtcbiAgICAgIHJldHVybiBhbm5vdGF0b3IuaGl0X21lbnVpdGVtID0gdHJ1ZTtcbiAgICB9KTtcbiAgICBzZWxlY3Rvci5nZXRfaW5wdXRfZWxlbWVudCgpLm1vdXNlbW92ZShmdW5jdGlvbihlKSB7XG4gICAgICByZXR1cm4gYW5ub3RhdG9yLmhpdF9tZW51aXRlbSA9IHRydWU7XG4gICAgfSk7XG4gICAgc2VsZWN0b3IuZ2V0X2lucHV0X2VsZW1lbnQoKS5tb3VzZXVwKGZ1bmN0aW9uKGUpIHtcbiAgICAgIHJldHVybiBhbm5vdGF0b3IuaGl0X21lbnVpdGVtID0gdHJ1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gc2VsZWN0b3IuZ2V0X2lucHV0X2VsZW1lbnQoKS5wYXJlbnQoKS5tb3VzZWRvd24oZnVuY3Rpb24oZSkge1xuICAgICAgcmV0dXJuIGFubm90YXRvci5oaXRfbWVudWl0ZW0gPSB0cnVlO1xuICAgIH0pO1xuICB9O1xuXG4gIEJCb3hBbm5vdGF0b3IucHJvdG90eXBlLmFkZF9lbnRyeSA9IGZ1bmN0aW9uKGVudHJ5KSB7XG4gICAgdmFyIGFubm90YXRvciwgYm94X2VsZW1lbnQsIGNsb3NlX2J1dHRvbiwgdGV4dF9ib3g7XG4gICAgdGhpcy5lbnRyaWVzLnB1c2goZW50cnkpO1xuICAgIGJveF9lbGVtZW50ID0gJCgnPGRpdiBjbGFzcz1cImFubm90YXRlZF9ib3VuZGluZ19ib3hcIj48L2Rpdj4nKTtcbiAgICBib3hfZWxlbWVudC5hcHBlbmRUbyh0aGlzLmltYWdlX2ZyYW1lKS5jc3Moe1xuICAgICAgXCJib3JkZXJcIjogdGhpcy5ib3JkZXJfd2lkdGggKyBcInB4IHNvbGlkIHJnYigxMjcsMjU1LDEyNylcIixcbiAgICAgIFwicG9zaXRpb25cIjogXCJhYnNvbHV0ZVwiLFxuICAgICAgXCJ0b3BcIjogKGVudHJ5LnRvcCAtIHRoaXMuYm9yZGVyX3dpZHRoKSArIFwicHhcIixcbiAgICAgIFwibGVmdFwiOiAoZW50cnkubGVmdCAtIHRoaXMuYm9yZGVyX3dpZHRoKSArIFwicHhcIixcbiAgICAgIFwid2lkdGhcIjogZW50cnkud2lkdGggKyBcInB4XCIsXG4gICAgICBcImhlaWdodFwiOiBlbnRyeS5oZWlnaHQgKyBcInB4XCIsXG4gICAgICBcImNvbG9yXCI6IFwicmdiKDEyNywyNTUsMTI3KVwiLFxuICAgICAgXCJmb250LWZhbWlseVwiOiBcIm1vbm9zcGFjZVwiLFxuICAgICAgXCJmb250LXNpemVcIjogXCJzbWFsbFwiXG4gICAgfSk7XG4gICAgY2xvc2VfYnV0dG9uID0gJCgnPGRpdj48L2Rpdj4nKS5hcHBlbmRUbyhib3hfZWxlbWVudCkuY3NzKHtcbiAgICAgIFwicG9zaXRpb25cIjogXCJhYnNvbHV0ZVwiLFxuICAgICAgXCJ0b3BcIjogXCItOHB4XCIsXG4gICAgICBcInJpZ2h0XCI6IFwiLThweFwiLFxuICAgICAgXCJ3aWR0aFwiOiBcIjE2cHhcIixcbiAgICAgIFwiaGVpZ2h0XCI6IFwiMFwiLFxuICAgICAgXCJwYWRkaW5nXCI6IFwiMTZweCAwIDAgMFwiLFxuICAgICAgXCJvdmVyZmxvd1wiOiBcImhpZGRlblwiLFxuICAgICAgXCJjb2xvclwiOiBcIiNmZmZcIixcbiAgICAgIFwiYmFja2dyb3VuZC1jb2xvclwiOiBcIiMwMzBcIixcbiAgICAgIFwiYm9yZGVyXCI6IFwiMnB4IHNvbGlkICNmZmZcIixcbiAgICAgIFwiLW1vei1ib3JkZXItcmFkaXVzXCI6IFwiMThweFwiLFxuICAgICAgXCItd2Via2l0LWJvcmRlci1yYWRpdXNcIjogXCIxOHB4XCIsXG4gICAgICBcImJvcmRlci1yYWRpdXNcIjogXCIxOHB4XCIsXG4gICAgICBcImN1cnNvclwiOiBcInBvaW50ZXJcIixcbiAgICAgIFwiLW1vei11c2VyLXNlbGVjdFwiOiBcIm5vbmVcIixcbiAgICAgIFwiLXdlYmtpdC11c2VyLXNlbGVjdFwiOiBcIm5vbmVcIixcbiAgICAgIFwidXNlci1zZWxlY3RcIjogXCJub25lXCIsXG4gICAgICBcInRleHQtYWxpZ25cIjogXCJjZW50ZXJcIlxuICAgIH0pO1xuICAgICQoXCI8ZGl2PjwvZGl2PlwiKS5hcHBlbmRUbyhjbG9zZV9idXR0b24pLmh0bWwoJyYjMjE1OycpLmNzcyh7XG4gICAgICBcImRpc3BsYXlcIjogXCJibG9ja1wiLFxuICAgICAgXCJ0ZXh0LWFsaWduXCI6IFwiY2VudGVyXCIsXG4gICAgICBcIndpZHRoXCI6IFwiMTZweFwiLFxuICAgICAgXCJwb3NpdGlvblwiOiBcImFic29sdXRlXCIsXG4gICAgICBcInRvcFwiOiBcIi0ycHhcIixcbiAgICAgIFwibGVmdFwiOiBcIjBcIixcbiAgICAgIFwiZm9udC1zaXplXCI6IFwiMTZweFwiLFxuICAgICAgXCJsaW5lLWhlaWdodFwiOiBcIjE2cHhcIixcbiAgICAgIFwiZm9udC1mYW1pbHlcIjogJ1wiSGVsdmV0aWNhIE5ldWVcIiwgQ29uc29sYXMsIFZlcmRhbmEsIFRhaG9tYSwgQ2FsaWJyaSwgJyArICdIZWx2ZXRpY2EsIE1lbmxvLCBcIkRyb2lkIFNhbnNcIiwgc2Fucy1zZXJpZidcbiAgICB9KTtcbiAgICB0ZXh0X2JveCA9ICQoJzxkaXY+PC9kaXY+JykuYXBwZW5kVG8oYm94X2VsZW1lbnQpLmNzcyh7XG4gICAgICBcIm92ZXJmbG93XCI6IFwiaGlkZGVuXCJcbiAgICB9KTtcbiAgICBpZiAodGhpcy5zaG93X2xhYmVsKSB7XG4gICAgICB0ZXh0X2JveC50ZXh0KGVudHJ5LmxhYmVsKTtcbiAgICB9XG4gICAgYW5ub3RhdG9yID0gdGhpcztcbiAgICBib3hfZWxlbWVudC5ob3ZlcigoZnVuY3Rpb24oZSkge1xuICAgICAgcmV0dXJuIGNsb3NlX2J1dHRvbi5zaG93KCk7XG4gICAgfSksIChmdW5jdGlvbihlKSB7XG4gICAgICByZXR1cm4gY2xvc2VfYnV0dG9uLmhpZGUoKTtcbiAgICB9KSk7XG4gICAgY2xvc2VfYnV0dG9uLm1vdXNlZG93bihmdW5jdGlvbihlKSB7XG4gICAgICByZXR1cm4gYW5ub3RhdG9yLmhpdF9tZW51aXRlbSA9IHRydWU7XG4gICAgfSk7XG4gICAgY2xvc2VfYnV0dG9uLmNsaWNrKGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciBjbGlja2VkX2JveCwgaW5kZXg7XG4gICAgICBjbGlja2VkX2JveCA9IGNsb3NlX2J1dHRvbi5wYXJlbnQoXCIuYW5ub3RhdGVkX2JvdW5kaW5nX2JveFwiKTtcbiAgICAgIGluZGV4ID0gY2xpY2tlZF9ib3gucHJldkFsbChcIi5hbm5vdGF0ZWRfYm91bmRpbmdfYm94XCIpLmxlbmd0aDtcbiAgICAgIGNsaWNrZWRfYm94LmRldGFjaCgpO1xuICAgICAgYW5ub3RhdG9yLmVudHJpZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIHJldHVybiBhbm5vdGF0b3Iub25jaGFuZ2UoYW5ub3RhdG9yLmVudHJpZXMpO1xuICAgIH0pO1xuICAgIHJldHVybiBjbG9zZV9idXR0b24uaGlkZSgpO1xuICB9O1xuXG4gIEJCb3hBbm5vdGF0b3IucHJvdG90eXBlLmNsZWFyX2FsbCA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLmFubm90YXRvcl9lbGVtZW50LmZpbmQoXCIuYW5ub3RhdGVkX2JvdW5kaW5nX2JveFwiKS5kZXRhY2goKTtcbiAgICB0aGlzLmVudHJpZXMuc3BsaWNlKDApO1xuICAgIHJldHVybiB0aGlzLm9uY2hhbmdlKHRoaXMuZW50cmllcyk7XG4gIH07XG5cbiAgcmV0dXJuIEJCb3hBbm5vdGF0b3I7XG5cbn0pKCk7Il19
